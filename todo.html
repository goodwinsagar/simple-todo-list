<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Simple To-Do List</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 400px;
        margin: 30px auto;
        padding: 10px;
      }
      h2 {
        text-align: center;
      }
      #new-task {
        width: 80%;
        padding: 8px;
        margin-right: 5px;
      }
      button {
        padding: 8px 12px;
      }
      ul {
        list-style: none;
        padding: 0;
      }
      li {
        display: flex;
        justify-content: space-between;
        padding: 8px;
        border-bottom: 1px solid #ccc;
        align-items: center;
      }
      li.completed span.task-text {
        text-decoration: line-through;
        color: gray;
      }
      span.task-text {
        flex-grow: 1;
        cursor: pointer;
      }
      button.edit,
      button.delete {
        margin-left: 5px;
        font-size: 14px;
      }
      input.edit-input {
        flex-grow: 1;
        padding: 4px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <h2>Simple To-Do List</h2>
    <input type="text" id="new-task" placeholder="Add new task..." />
    <button id="add-btn">Add</button>
    <ul id="task-list"></ul>

    <script>
      const taskInput = document.getElementById("new-task");
      const addBtn = document.getElementById("add-btn");
      const taskList = document.getElementById("task-list");

      function getTasks() {
        return JSON.parse(localStorage.getItem("tasks") || "[]");
      }

      function saveTasks(tasks) {
        localStorage.setItem("tasks", JSON.stringify(tasks));
      }

      function renderTasks() {
        let tasks = getTasks();

        // Sort tasks: incomplete first, then completed
        tasks = tasks.slice().sort((a, b) => {
          if (a.completed === b.completed) return 0;
          return a.completed ? 1 : -1;
        });

        taskList.innerHTML = "";

        tasks.forEach((task, sortIndex) => {
          const li = document.createElement("li");
          li.className = task.completed ? "completed" : "";

          const span = document.createElement("span");
          span.textContent = task.text;
          span.className = "task-text";
          span.onclick = () => {
            // Find original index by matching text & completed status
            const originalTasks = getTasks();
            const originalIndex = originalTasks.findIndex(
              (t) => t.text === task.text && t.completed === task.completed
            );
            toggleComplete(originalIndex);
          };

          li.appendChild(span);

          // Edit button
          const editBtn = document.createElement("button");
          editBtn.textContent = "Edit";
          editBtn.className = "edit";
          editBtn.onclick = () => {
            const originalTasks = getTasks();
            const originalIndex = originalTasks.findIndex(
              (t) => t.text === task.text && t.completed === task.completed
            );
            editTask(originalIndex);
          };
          li.appendChild(editBtn);

          // Delete button
          const delBtn = document.createElement("button");
          delBtn.textContent = "Delete";
          delBtn.className = "delete";
          delBtn.onclick = () => {
            const originalTasks = getTasks();
            const originalIndex = originalTasks.findIndex(
              (t) => t.text === task.text && t.completed === task.completed
            );
            removeTask(originalIndex);
          };
          li.appendChild(delBtn);

          taskList.appendChild(li);
        });
      }

      function addTask() {
        const text = taskInput.value.trim();
        if (!text) return alert("Please enter a task");

        const tasks = getTasks();
        tasks.push({ text, completed: false });
        saveTasks(tasks);
        taskInput.value = "";
        renderTasks();
      }

      function editTask(index) {
        const tasks = getTasks();
        const li = taskList.children[index];
        li.innerHTML = "";

        const input = document.createElement("input");
        input.type = "text";
        input.value = tasks[index].text;
        input.className = "edit-input";

        input.onkeydown = (e) => {
          if (e.key === "Enter") {
            if (!input.value.trim()) {
              alert("Task cannot be empty");
              return;
            }
            tasks[index].text = input.value.trim();
            saveTasks(tasks);
            renderTasks();
          } else if (e.key === "Escape") {
            renderTasks();
          }
        };

        li.appendChild(input);
        input.focus();
      }

      function removeTask(index) {
        const tasks = getTasks();
        tasks.splice(index, 1);
        saveTasks(tasks);
        renderTasks();
      }

      function toggleComplete(index) {
        const tasks = getTasks();
        tasks[index].completed = !tasks[index].completed;
        saveTasks(tasks);
        renderTasks();
      }

      addBtn.onclick = addTask;

      taskInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") addTask();
      });

      // Initial render on page load
      renderTasks();
    </script>
  </body>
</html>
